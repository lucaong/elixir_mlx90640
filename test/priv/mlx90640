#!/usr/bin/env bash

# This is a test executable that simulates, for testing purposes, the byte
# protocol sent by the MLX90640 C++ to Elixir binding provided by this project.

frame_time=$(echo "scale=3; 1 / $1" | bc)

if [ "$2" = "runloop" ]; then
  while :
  do
    # 0x06 0x00 = 768 * 2 (data length in bytes)
    # 0x1b 0x49 = 27.73 encoded in protocol
    # 0x2e 0xc9 = -46.73 encoded in protocol
    printf "%b" '\x06\x00\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9\x1b\x49\x2e\xc9'
    sleep $frame_time
  done
else
  $0 $1 runloop &
  pid=$!

  while read line ; do
    :
  done

  kill -KILL $pid
fi
